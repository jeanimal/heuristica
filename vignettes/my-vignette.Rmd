---
title: "Using heuristica"
author: "Jean Whitmore"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

Heuristica wraps up several inference heuristics in an easily-reused form. Heuristics are simple rules of thumb that do not try to maximize likelihood or minimize error when fitting, as for example linear regression does.  Nevertheless, heuristics can in some cases achieve lower predictive error than the methods that maximize or minimize.  This package can help you explore when and why this is the case.

## Installation

To get the github version of heuristica:

```{r}
# Uncomment and execute install functions you may need.
# install.packages("devtools") 
# Uncomment and execute 
# install.packages("heuristica") 
#    -- OR --
# devtools::install_github("jeanimal/heuristica")
#    -- OR --
# devtools::load_all()
library("heuristica")
```

## The task

The inference task in this package involves using several predictor variables, or cues, to infer a criterion value.  For example, consider a data set about Chicago high schools.  Given the cues of average math scores, average reading scores, percent of low-income students, and percent of non-White students, infer each school's dropout rate, the criterion.

A variant of this task is two-alternative choice.  For example, given the above cues about two Chicago high school, infer which school has the higher dropout rates.  The criterion is binary, one of the two schools.  It is either correct or incorrect, and over many schools, we can calculate the percent of errors that were correct, which will range from 0 to 100%.

Because of this task structure, all of the models will have the same basic fitting interface:
* A data set-- as a matrix or data.frame
* The index of the criterion column in the data set
* A vector of indices of the cue columns in the data set

## Take The Best

ttbModel is an implementation of An implementation of [Take The Best](http://en.wikipedia.org/wiki/Take-the-best_heuristic). It sorts cues in order of cue validity, making a decision based on the first cue that discriminates (has differing values on the two objects).

Let us focus on just a few high schools and variables from the drop-out rates data set.
```{r}
schools <- highschool_dropout[which(highschool_dropout$Name_of_School %in% c("Bowen", "Collins", "Young")),]
schools <- schools[, c("Name_of_School", "Dropout_Rate", "Low_Income_Students", "Limited_English_Students", "Percent_Black_Students")]
schools
```

Then we run Take The Best by giving it the data frame, specifying column 2 as the criterion and columns 3-5 as the predictor cues.  The output is the fitted take the best model.  We output the cue_validities so you can geta sense of what is involved in the fit.
```{r}
ttb <- ttbModel(schools, 2, c(3:5))
ttb$cue_validities
```

We can use this model to generate predictions by passing the predict function the model and some data to predict on.  It will assume the predictor cues are still in columns 2 through 5.  Let us first have it try to predict using the data it used to fit:
```{r}
pctCorrectOfPredictPair(list(ttb), schools)
```

Not bad.

Now let us get data from other schools and see how well it predicts there.
```{r}
more_schools <- highschool_dropout[which(highschool_dropout$Name_of_School %in% c('Fenger', 'Juarez', 'Kenwood')),]
more_schools <- more_schools[, c("Name_of_School", "Dropout_Rate", "Low_Income_Students", "Limited_English_Students", "Percent_Black_Students")]
more_schools
pctCorrectOfPredictPair(list(ttb), more_schools)
```

A key point here is that this prediciton is based on the cue validities fitted from the original schools.  This is an out-of-sample prediction, a generalization from one set of schools to another.  

Fitting the same sample is a much easier task.  Here is the accuracy if TTB merely fitted Fenger, Juarez, and Kenwood.
```{r}
ttb_more_schools <- ttbModel(more_schools, 2, c(3:5))
pctCorrectOfPredictPair(list(ttb_more_schools), more_schools)
```


## Regression

In order to make comparison with regression easier, the package provides a wrapper that gives it the same interface as the heuristics: A data set, a criterion column, and a vector of cue columns.

```{r}
reg <- regModel(schools, 2, c(3:5))
pctCorrectOfPredictPair(list(ttb, reg), schools)
```
Both Take The Best and Regression performed well.

Now let's compare at out-of-sample accuracy.

```{r}
pctCorrectOfPredictPair(list(ttb, reg), more_schools)
```
Both ttb and regression struggled on this.

